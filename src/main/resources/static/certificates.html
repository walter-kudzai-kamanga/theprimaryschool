<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Certificates | Kamanga Primary</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link rel="stylesheet" href="assets/css/style.css">
  <style>
    body { background: #f4f6fb; }
    .cert-card { border-radius: 16px; box-shadow: 0 4px 24px rgba(0,0,0,0.07); background: #fff; margin-bottom: 24px; transition: box-shadow 0.2s; }
    .cert-card:hover { box-shadow: 0 8px 32px rgba(0,0,0,0.13); }
    .cert-badge { border-radius: 8px; font-size: 0.8rem; padding: 4px 10px; margin-right: 6px; }
    .cert-status { font-size: 0.9rem; font-weight: 600; }
    .cert-status.issued { color: #28a745; }
    .cert-status.awaiting { color: #ffc107; }
    .cert-status.processing { color: #17a2b8; }
    .cert-status.expired { color: #dc3545; }
    .cert-tags .badge { margin-right: 4px; }
    .cert-preview-img { max-width: 100%; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .cert-list-search { max-width: 350px; }
    .timeline { position: relative; margin: 2rem 0; }
    .timeline::before { content: ''; position: absolute; left: 20px; top: 0; bottom: 0; width: 4px; background: #e9ecef; border-radius: 2px; }
    .timeline-event { position: relative; margin-left: 60px; margin-bottom: 32px; }
    .timeline-event:last-child { margin-bottom: 0; }
    .timeline-dot { position: absolute; left: -40px; top: 0; width: 32px; height: 32px; background: #fff; border: 4px solid #28a745; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: #28a745; box-shadow: 0 2px 8px rgba(0,0,0,0.07); }
    .badge-micro { background: linear-gradient(45deg, #007bff, #6610f2); color: #fff; border-radius: 50%; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin: 0 8px 8px 0; }
    .cert-upload-box { border: 2px dashed #20c997; border-radius: 12px; padding: 24px; background: #f8f9fa; text-align: center; cursor: pointer; transition: border-color 0.2s; }
    .cert-upload-box:hover { border-color: #28a745; }
    .summary-card { background: linear-gradient(135deg, #28a745, #20c997); color: #fff; border-radius: 16px; box-shadow: 0 4px 24px rgba(40,167,69,0.07); }
    .summary-card h2 { font-size: 2.5rem; }
    .summary-card .lead { font-size: 1.2rem; }
    .cert-action-btn { margin-right: 8px; }
    .cert-qr { width: 80px; height: 80px; margin: 0 auto; }
    .cert-detail-label { font-weight: 600; color: #6c757d; }
    .cert-detail-value { color: #495057; }
    .cert-detail-badge { font-size: 0.9rem; }
    .cert-share-btn { margin-right: 8px; }
    .cert-category-tab .nav-link { font-weight: 600; }
    .cert-category-tab .nav-link.active { background: #28a745; color: #fff; }
    .cert-request-form .form-label { font-weight: 500; }
    .cert-request-form .form-select, .cert-request-form .form-control { border-radius: 8px; }
    .cert-upload-list .badge { margin-right: 4px; }
    
    /* Modern Certificate Styles */
    .certificate-container {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    
    .certificate-container:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(0,0,0,0.15);
    }
    
    .certificate {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      border: 3px solid #28a745;
      border-radius: 20px;
      padding: 40px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 24px rgba(40,167,69,0.15);
    }
    
    .certificate::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 20%, rgba(40,167,69,0.05) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(32,201,151,0.05) 0%, transparent 50%),
        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="%23e9ecef" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
      opacity: 0.4;
      pointer-events: none;
    }
    
    .certificate-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 40px;
      position: relative;
      z-index: 2;
    }
    
    .school-logo {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #28a745, #20c997);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 2rem;
      box-shadow: 0 4px 16px rgba(40,167,69,0.3);
    }
    
    .school-info {
      text-align: center;
      flex: 1;
      margin: 0 20px;
    }
    
    .school-info h1 {
      font-size: 1.8rem;
      font-weight: 700;
      color: #2c3e50;
      margin-bottom: 8px;
      letter-spacing: 2px;
    }
    
    .school-motto {
      font-size: 0.9rem;
      color: #6c757d;
      font-style: italic;
      margin-bottom: 4px;
    }
    
    .school-address {
      font-size: 0.8rem;
      color: #495057;
      margin-bottom: 0;
    }
    
    .certificate-seal {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #dc3545, #c82333);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
      box-shadow: 0 4px 16px rgba(220,53,69,0.3);
    }
    
    .certificate-body {
      position: relative;
      z-index: 2;
    }
    
    .certificate-title {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .certificate-title h2 {
      font-size: 2.2rem;
      font-weight: 700;
      color: #2c3e50;
      margin-bottom: 10px;
      letter-spacing: 3px;
    }
    
    .title-underline {
      width: 120px;
      height: 4px;
      background: linear-gradient(90deg, #28a745, #20c997);
      margin: 0 auto;
      border-radius: 2px;
    }
    
    .certificate-content {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .presentation-text {
      font-size: 1.1rem;
      color: #6c757d;
      margin-bottom: 20px;
    }
    
    .student-name {
      margin: 30px 0;
    }
    
    .student-name h3 {
      font-size: 2.5rem;
      font-weight: 700;
      color: #28a745;
      margin-bottom: 0;
      text-shadow: 2px 2px 4px rgba(40,167,69,0.1);
      letter-spacing: 2px;
      background: linear-gradient(135deg, #28a745, #20c997);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .achievement-text {
      font-size: 1.1rem;
      color: #6c757d;
      margin-bottom: 20px;
    }
    
    .achievement-title {
      margin: 30px 0;
    }
    
    .achievement-title h4 {
      font-size: 1.8rem;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 0;
      letter-spacing: 1px;
    }
    
    .achievement-description {
      font-size: 1rem;
      color: #495057;
      line-height: 1.6;
      max-width: 600px;
      margin: 0 auto;
    }
    
    .certificate-footer {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      margin-top: 50px;
      position: relative;
      z-index: 2;
    }
    
    .signature-section {
      text-align: center;
      flex: 1;
    }
    
    .signature-line {
      width: 150px;
      height: 2px;
      background: #2c3e50;
      margin: 0 auto 10px;
    }
    
    .signature-name {
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 4px;
    }
    
    .signature-title {
      font-size: 0.9rem;
      color: #6c757d;
      margin-bottom: 0;
    }
    
    .date-section {
      text-align: center;
      flex: 1;
    }
    
    .date-label {
      font-size: 0.9rem;
      color: #6c757d;
      margin-bottom: 4px;
    }
    
    .date-value {
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 0;
    }
    
    .verification-section {
      text-align: center;
      flex: 1;
    }
    
    .verification-code {
      margin-bottom: 15px;
    }
    
    .code-label {
      font-size: 0.8rem;
      color: #6c757d;
      margin-bottom: 4px;
    }
    
    .code-value {
      font-family: 'Courier New', monospace;
      font-weight: 600;
      color: #28a745;
      margin-bottom: 0;
      font-size: 0.9rem;
    }
    
    .qr-code-placeholder {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 2px solid #dee2e6;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #6c757d;
      font-size: 1.5rem;
      margin: 0 auto;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    
    .qr-code-placeholder:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .certificate-border {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
    }
    
    .border-pattern {
      position: absolute;
      top: 10px;
      left: 10px;
      right: 10px;
      bottom: 10px;
      border: 2px solid rgba(40,167,69,0.3);
      border-radius: 15px;
      background: linear-gradient(45deg, transparent 30%, rgba(40,167,69,0.05) 50%, transparent 70%);
    }
    
    .certificate::after {
      content: '';
      position: absolute;
      top: 15px;
      left: 15px;
      right: 15px;
      bottom: 15px;
      border: 1px solid rgba(40,167,69,0.1);
      border-radius: 12px;
      pointer-events: none;
    }
    
    @media (max-width: 991px) {
      .timeline-event { margin-left: 40px; }
      .timeline-dot { left: -30px; width: 24px; height: 24px; font-size: 1rem; }
      
      .certificate {
        padding: 20px;
      }
      
      .certificate-header {
        flex-direction: column;
        text-align: center;
        gap: 20px;
      }
      
      .school-info h1 {
        font-size: 1.4rem;
      }
      
      .student-name h3 {
        font-size: 2rem;
      }
      
      .certificate-footer {
        flex-direction: column;
        gap: 20px;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="bg-success text-white py-3">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-6">
          <h1 class="mb-2"><i class="fas fa-certificate me-2"></i>Certificates & Achievements</h1>
          <p class="mb-0">Track your academic and extracurricular accomplishments</p>
        </div>
        <div class="col-md-6 text-end">
          <a href="students.html" class="btn btn-light">
            <i class="fas fa-arrow-left me-2"></i>Back to Portal
          </a>
        </div>
      </div>
    </div>
  </header>

  <div class="container-fluid mt-4">
    <!-- Achievements Summary -->
    <div class="row mb-4">
      <div class="col-lg-8">
        <div class="summary-card p-4 position-relative overflow-hidden">
          <div class="position-absolute top-0 end-0 p-3">
            <i class="bi bi-trophy-fill text-white opacity-25" style="font-size: 4rem;"></i>
          </div>
          <div class="row align-items-center">
            <div class="col-md-6">
              <div class="d-flex align-items-center mb-3">
                <div class="bg-white bg-opacity-25 rounded-circle p-3 me-3">
                  <i class="bi bi-award-fill text-white" style="font-size: 2rem;"></i>
                </div>
                <div>
                  <h2 id="totalCertificates" class="mb-0 text-white">12</h2>
                  <p class="lead mb-0 text-white-50">Certificates Earned This Year</p>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="row text-center">
                <div class="col-4">
                  <div class="bg-white bg-opacity-25 rounded p-2 mb-2">
                    <h4 class="text-white mb-0">6</h4>
                    <small class="text-white-50">STEM</small>
                  </div>
                </div>
                <div class="col-4">
                  <div class="bg-white bg-opacity-25 rounded p-2 mb-2">
                    <h4 class="text-white mb-0">3</h4>
                    <small class="text-white-50">Debate</small>
                  </div>
                </div>
                <div class="col-4">
                  <div class="bg-white bg-opacity-25 rounded p-2 mb-2">
                    <h4 class="text-white mb-0">3</h4>
                    <small class="text-white-50">Sports</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body text-center d-flex flex-column">
            <div class="bg-success bg-opacity-10 rounded-circle p-3 mx-auto mb-3" style="width: 80px; height: 80px;">
              <i class="bi bi-download text-success" style="font-size: 2rem;"></i>
            </div>
            <h5 class="fw-bold">Download Summary</h5>
            <p class="text-muted flex-grow-1">Get a complete report of all your achievements</p>
            <button class="btn btn-success btn-lg" onclick="downloadSummary()">
              <i class="bi bi-file-earmark-pdf me-2"></i>Download Report
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-body p-0">
        <ul class="nav nav-pills nav-fill cert-category-tab" id="certTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active rounded-0 border-0" id="all-tab" data-bs-toggle="pill" data-bs-target="#all" type="button">
              <i class="bi bi-collection me-2"></i>All Certificates
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link rounded-0 border-0" id="academic-tab" data-bs-toggle="pill" data-bs-target="#academic" type="button">
              <i class="bi bi-mortarboard me-2"></i>Academic
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link rounded-0 border-0" id="participation-tab" data-bs-toggle="pill" data-bs-target="#participation" type="button">
              <i class="bi bi-people me-2"></i>Participation
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link rounded-0 border-0" id="merit-tab" data-bs-toggle="pill" data-bs-target="#merit" type="button">
              <i class="bi bi-trophy me-2"></i>Merit
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link rounded-0 border-0" id="extracurricular-tab" data-bs-toggle="pill" data-bs-target="#extracurricular" type="button">
              <i class="bi bi-lightning me-2"></i>Extra-curricular
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link rounded-0 border-0" id="digital-tab" data-bs-toggle="pill" data-bs-target="#digital" type="button">
              <i class="bi bi-code-slash me-2"></i>Digital Skills
            </button>
          </li>
        </ul>
      </div>
    </div>

    <!-- Search and Filter -->
    <div class="row mb-4">
      <div class="col-md-6">
        <div class="input-group cert-list-search shadow-sm">
          <span class="input-group-text border-0 bg-light">
            <i class="bi bi-search text-muted"></i>
          </span>
          <input type="text" class="form-control border-0 bg-light" id="certSearch" placeholder="Search certificates...">
          <button class="btn btn-outline-secondary border-0 bg-light" type="button" data-bs-toggle="dropdown">
            <i class="bi bi-funnel"></i>
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#" onclick="filterByStatus('all')">All Status</a></li>
            <li><a class="dropdown-item" href="#" onclick="filterByStatus('issued')">Issued</a></li>
            <li><a class="dropdown-item" href="#" onclick="filterByStatus('awaiting')">Awaiting</a></li>
            <li><a class="dropdown-item" href="#" onclick="filterByStatus('processing')">Processing</a></li>
          </ul>
        </div>
      </div>
      <div class="col-md-6 text-end">
        <div class="btn-group" role="group">
          <button class="btn btn-outline-primary" onclick="showRequestModal()">
            <i class="bi bi-plus-circle me-2"></i>Request Certificate
          </button>
          <button class="btn btn-outline-success" onclick="showUploadModal()">
            <i class="bi bi-cloud-upload me-2"></i>Upload External
          </button>
        </div>
      </div>
    </div>

    <!-- Tab Content -->
    <div class="tab-content" id="certTabContent">
      <!-- All Certificates -->
      <div class="tab-pane fade show active" id="all" role="tabpanel">
        <div class="row" id="allCertificates">
          <!-- Certificate cards will be populated by JavaScript -->
        </div>
      </div>

      <!-- Academic Certificates -->
      <div class="tab-pane fade" id="academic" role="tabpanel">
        <div class="row" id="academicCertificates">
          <!-- Academic certificate cards -->
        </div>
      </div>

      <!-- Participation Certificates -->
      <div class="tab-pane fade" id="participation" role="tabpanel">
        <div class="row" id="participationCertificates">
          <!-- Participation certificate cards -->
        </div>
      </div>

      <!-- Merit Certificates -->
      <div class="tab-pane fade" id="merit" role="tabpanel">
        <div class="row" id="meritCertificates">
          <!-- Merit certificate cards -->
        </div>
      </div>

      <!-- Extra-curricular Certificates -->
      <div class="tab-pane fade" id="extracurricular" role="tabpanel">
        <div class="row" id="extracurricularCertificates">
          <!-- Extra-curricular certificate cards -->
        </div>
      </div>

      <!-- Digital Skills Certificates -->
      <div class="tab-pane fade" id="digital" role="tabpanel">
        <div class="row" id="digitalCertificates">
          <!-- Digital skills certificate cards -->
        </div>
      </div>
    </div>

    <!-- Timeline View -->
    <div class="row mt-5">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-transparent border-0">
            <div class="d-flex align-items-center">
              <div class="bg-primary bg-opacity-10 rounded-circle p-2 me-3">
                <i class="bi bi-calendar-event text-primary"></i>
              </div>
              <h5 class="mb-0 fw-bold">Certificate Timeline</h5>
            </div>
          </div>
          <div class="card-body">
            <div class="timeline">
              <div class="timeline-event">
                <div class="timeline-dot bg-success">
                  <i class="bi bi-award-fill text-white"></i>
                </div>
                <div class="card cert-card border-0 shadow-sm">
                  <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col-md-8">
                        <div class="d-flex align-items-center mb-2">
                          <h6 class="mb-0 fw-bold">Grade 8 Final Report</h6>
                          <span class="badge bg-success ms-2">
                            <i class="bi bi-check-circle-fill me-1"></i>Issued
                          </span>
                        </div>
                        <p class="text-muted mb-2">Academic Excellence Award</p>
                        <div class="cert-tags">
                          <span class="badge bg-primary bg-opacity-75">Academic</span>
                          <span class="badge bg-success bg-opacity-75">Top 5%</span>
                        </div>
                      </div>
                      <div class="col-md-4 text-end">
                        <p class="text-muted mb-0">
                          <i class="bi bi-calendar-event me-1"></i>Dec 2024
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="timeline-event">
                <div class="timeline-dot bg-warning">
                  <i class="bi bi-trophy-fill text-white"></i>
                </div>
                <div class="card cert-card border-0 shadow-sm">
                  <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col-md-8">
                        <div class="d-flex align-items-center mb-2">
                          <h6 class="mb-0 fw-bold">Debate Club Championship</h6>
                          <span class="badge bg-success ms-2">
                            <i class="bi bi-check-circle-fill me-1"></i>Issued
                          </span>
                        </div>
                        <p class="text-muted mb-2">First Place - Regional Competition</p>
                        <div class="cert-tags">
                          <span class="badge bg-info bg-opacity-75">Participation</span>
                          <span class="badge bg-warning bg-opacity-75">Leadership</span>
                        </div>
                      </div>
                      <div class="col-md-4 text-end">
                        <p class="text-muted mb-0">
                          <i class="bi bi-calendar-event me-1"></i>Nov 2024
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="timeline-event">
                <div class="timeline-dot bg-danger">
                  <i class="bi bi-lightning-fill text-white"></i>
                </div>
                <div class="card cert-card border-0 shadow-sm">
                  <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col-md-8">
                        <div class="d-flex align-items-center mb-2">
                          <h6 class="mb-0 fw-bold">Science Olympiad</h6>
                          <span class="badge bg-success ms-2">
                            <i class="bi bi-check-circle-fill me-1"></i>Issued
                          </span>
                        </div>
                        <p class="text-muted mb-2">Mathematics Competition Winner</p>
                        <div class="cert-tags">
                          <span class="badge bg-primary bg-opacity-75">Academic</span>
                          <span class="badge bg-danger bg-opacity-75">STEM</span>
                        </div>
                      </div>
                      <div class="col-md-4 text-end">
                        <p class="text-muted mb-0">
                          <i class="bi bi-calendar-event me-1"></i>Oct 2024
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Micro-Credentials & Badges -->
    <div class="row mt-5">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-transparent border-0">
            <div class="d-flex align-items-center">
              <div class="bg-warning bg-opacity-10 rounded-circle p-2 me-3">
                <i class="bi bi-patch-check text-warning"></i>
              </div>
              <h5 class="mb-0 fw-bold">Micro-Credentials & Badges</h5>
            </div>
          </div>
          <div class="card-body">
            <div class="row g-3 justify-content-center">
              <div class="col-auto">
                <div class="badge-micro bg-primary" title="Coding Fundamentals">
                  <i class="bi bi-code-slash"></i>
                </div>
                <p class="text-center mt-2 small fw-bold">Coding</p>
              </div>
              <div class="col-auto">
                <div class="badge-micro bg-success" title="Public Speaking">
                  <i class="bi bi-megaphone"></i>
                </div>
                <p class="text-center mt-2 small fw-bold">Speaking</p>
              </div>
              <div class="col-auto">
                <div class="badge-micro bg-warning" title="Leadership">
                  <i class="bi bi-star-fill"></i>
                </div>
                <p class="text-center mt-2 small fw-bold">Leadership</p>
              </div>
              <div class="col-auto">
                <div class="badge-micro bg-info" title="Teamwork">
                  <i class="bi bi-people-fill"></i>
                </div>
                <p class="text-center mt-2 small fw-bold">Teamwork</p>
              </div>
              <div class="col-auto">
                <div class="badge-micro bg-danger" title="Problem Solving">
                  <i class="bi bi-lightbulb"></i>
                </div>
                <p class="text-center mt-2 small fw-bold">Problem Solving</p>
              </div>
              <div class="col-auto">
                <div class="badge-micro bg-secondary" title="Creativity">
                  <i class="bi bi-palette-fill"></i>
                </div>
                <p class="text-center mt-2 small fw-bold">Creativity</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Certificate Preview Modal -->
  <div class="modal fade" id="certPreviewModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Certificate Preview</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-lg-8">
              <div class="certificate-container" id="certificatePreview">
                <div class="certificate">
                  <div class="certificate-header">
                    <div class="school-logo">
                      <i class="fas fa-graduation-cap"></i>
                    </div>
                    <div class="school-info">
                      <h1>KAMANGA PRIMARY SCHOOL</h1>
                      <p class="school-motto">Excellence in Education, Character, and Leadership</p>
                      <p class="school-address">Lusaka, Zambia | Established 1995</p>
                    </div>
                    <div class="certificate-seal">
                      <div class="seal-inner">
                        <i class="fas fa-star"></i>
                      </div>
                    </div>
                  </div>
                  
                  <div class="certificate-body">
                    <div class="certificate-title">
                      <h2>CERTIFICATE OF ACHIEVEMENT</h2>
                      <div class="title-underline"></div>
                    </div>
                    
                    <div class="certificate-content">
                      <p class="presentation-text">
                        This is to certify that
                      </p>
                      <div class="student-name">
                        <h3>ALICE JOHNSON</h3>
                      </div>
                      <p class="achievement-text">
                        has successfully demonstrated exceptional performance and dedication in
                      </p>
                      <div class="achievement-title">
                        <h4>GRADE 8 ACADEMIC EXCELLENCE</h4>
                      </div>
                      <p class="achievement-description">
                        achieving outstanding results across all subjects with distinction in Mathematics, 
                        Science, and English Literature. This certificate recognizes the student's commitment 
                        to academic excellence, leadership qualities, and positive contribution to the school community.
                      </p>
                    </div>
                    
                    <div class="certificate-footer">
                      <div class="signature-section">
                        <div class="signature-line"></div>
                        <p class="signature-name">Mrs. Sarah Mwamba</p>
                        <p class="signature-title">Principal</p>
                      </div>
                      <div class="date-section">
                        <p class="date-label">Date of Issue</p>
                        <p class="date-value">December 15, 2024</p>
                      </div>
                      <div class="verification-section">
                        <div class="verification-code">
                          <p class="code-label">Verification Code</p>
                          <p class="code-value">CERT-2024-001234</p>
                        </div>
                        <div class="qr-code-placeholder">
                          <i class="fas fa-qrcode"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="certificate-border">
                    <div class="border-pattern"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-4">
              <div class="card">
                <div class="card-header">
                  <h6 class="mb-0">Certificate Details</h6>
                </div>
                <div class="card-body">
                  <div class="mb-3">
                    <label class="cert-detail-label">Title:</label>
                    <p class="cert-detail-value" id="certTitle">Grade 8 Final Report</p>
                  </div>
                  <div class="mb-3">
                    <label class="cert-detail-label">Issuing Authority:</label>
                    <p class="cert-detail-value" id="certAuthority">Kamanga Primary School</p>
                  </div>
                  <div class="mb-3">
                    <label class="cert-detail-label">Date Issued:</label>
                    <p class="cert-detail-value" id="certDate">December 15, 2024</p>
                  </div>
                  <div class="mb-3">
                    <label class="cert-detail-label">Certificate Type:</label>
                    <span class="badge bg-primary cert-detail-badge" id="certType">Academic</span>
                  </div>
                  <div class="mb-3">
                    <label class="cert-detail-label">Status:</label>
                    <span class="cert-status issued" id="certStatus">Issued</span>
                  </div>
                  <div class="mb-3">
                    <label class="cert-detail-label">Verification Code:</label>
                    <p class="cert-detail-value" id="certVerificationCode">CERT-2024-001234</p>
                  </div>
                  <div class="mb-3">
                    <div id="certQR" class="cert-qr"></div>
                    <small class="text-muted">Scan to verify</small>
                  </div>
                </div>
              </div>
              
              <div class="card mt-3">
                <div class="card-header">
                  <h6 class="mb-0">Actions</h6>
                </div>
                <div class="card-body">
                  <div class="d-grid gap-2">
                    <button class="btn btn-primary" onclick="downloadCertificate('pdf')">
                      <i class="fas fa-file-pdf me-2"></i>Download PDF
                    </button>
                    <button class="btn btn-success" onclick="downloadCertificate('image')">
                      <i class="fas fa-image me-2"></i>Download Image
                    </button>
                    <button class="btn btn-info" onclick="printCertificate()">
                      <i class="fas fa-print me-2"></i>Print Certificate
                    </button>
                    <button class="btn btn-warning" onclick="shareCertificate()">
                      <i class="fas fa-share-alt me-2"></i>Share Certificate
                    </button>
                    <button class="btn btn-secondary" onclick="verifyCertificate()">
                      <i class="fas fa-shield-alt me-2"></i>Verify Certificate
                    </button>
                    <button class="btn btn-dark" onclick="downloadWithQR()">
                      <i class="fas fa-qrcode me-2"></i>Download with QR
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Request Certificate Modal -->
  <div class="modal fade" id="requestCertModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Request Certificate</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="certRequestForm" class="cert-request-form">
            <div class="mb-3">
              <label class="form-label">Certificate Type</label>
              <select class="form-select" id="requestCertType" required>
                <option value="">Select certificate type...</option>
                <option value="academic">Academic Report</option>
                <option value="participation">Participation Certificate</option>
                <option value="merit">Merit Award</option>
                <option value="leadership">Leadership Certificate</option>
                <option value="attendance">Perfect Attendance</option>
                <option value="behavior">Good Behavior</option>
                <option value="reprint">Certificate Reprint</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Reason for Request</label>
              <textarea class="form-control" id="requestReason" rows="3" 
                        placeholder="Please explain why you need this certificate..." required></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">Delivery Type</label>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="deliveryType" value="digital" id="digitalDelivery" checked>
                <label class="form-check-label" for="digitalDelivery">Digital (PDF)</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="deliveryType" value="hardcopy" id="hardcopyDelivery">
                <label class="form-check-label" for="hardcopyDelivery">Hard Copy</label>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Expected Turnaround</label>
              <select class="form-select" id="turnaroundTime">
                <option value="urgent">Urgent (1-2 days)</option>
                <option value="normal" selected>Normal (3-5 days)</option>
                <option value="standard">Standard (1 week)</option>
              </select>
            </div>
            <div class="d-grid">
              <button type="submit" class="btn btn-success">
                <i class="fas fa-paper-plane me-2"></i>Submit Request
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Upload External Certificate Modal -->
  <div class="modal fade" id="uploadCertModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Upload External Certificate</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="uploadCertForm">
            <div class="mb-3">
              <label class="form-label">Certificate Title</label>
              <input type="text" class="form-control" id="uploadCertTitle" 
                     placeholder="e.g., Udemy Python Course Certificate" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Issuing Organization</label>
              <input type="text" class="form-control" id="uploadCertOrg" 
                     placeholder="e.g., Udemy, Coursera, Music School" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Certificate Type</label>
              <select class="form-select" id="uploadCertType" required>
                <option value="">Select type...</option>
                <option value="external">External Course</option>
                <option value="music">Music/Sports</option>
                <option value="online">Online Learning</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Date Earned</label>
              <input type="date" class="form-control" id="uploadCertDate" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Certificate File</label>
              <input type="file" class="form-control" id="uploadCertFile" 
                     accept=".pdf,.jpg,.jpeg,.png" required>
              <small class="text-muted">Supported formats: PDF, JPG, PNG</small>
            </div>
            <div class="mb-3">
              <label class="form-label">Visibility</label>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="certVisibility" value="public" id="publicCert" checked>
                <label class="form-check-label" for="publicCert">Public (visible to school)</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="certVisibility" value="private" id="privateCert">
                <label class="form-check-label" for="privateCert">Private (only you)</label>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Notes (Optional)</label>
              <textarea class="form-control" id="uploadCertNotes" rows="3" 
                        placeholder="Additional notes about this certificate..."></textarea>
            </div>
            <div class="d-grid">
              <button type="submit" class="btn btn-success">
                <i class="fas fa-upload me-2"></i>Upload Certificate
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Share Certificate Modal -->
  <div class="modal fade" id="shareCertModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Share Certificate</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Share Link</label>
            <div class="input-group">
              <input type="text" class="form-control" id="shareLink" 
                     value="https://kamangaprimary.edu.zm/certificates/verify/CERT-2024-001234" readonly>
              <button class="btn btn-outline-secondary" onclick="copyShareLink()">
                <i class="fas fa-copy"></i>
              </button>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Share via</label>
            <div class="d-grid gap-2">
              <button class="btn btn-outline-primary cert-share-btn" onclick="shareViaEmail()">
                <i class="fas fa-envelope me-2"></i>Email
              </button>
              <button class="btn btn-outline-success cert-share-btn" onclick="shareViaWhatsApp()">
                <i class="fab fa-whatsapp me-2"></i>WhatsApp
              </button>
              <button class="btn btn-outline-info cert-share-btn" onclick="shareViaLinkedIn()">
                <i class="fab fa-linkedin me-2"></i>LinkedIn
              </button>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Download with QR Code</label>
            <button class="btn btn-outline-secondary w-100" onclick="downloadWithQR()">
              <i class="fas fa-qrcode me-2"></i>Download Certificate with QR
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Verify Certificate Modal -->
  <div class="modal fade" id="verifyCertModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Verify Certificate</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body text-center">
          <div class="mb-4">
            <i class="fas fa-shield-check text-success" style="font-size: 3rem;"></i>
          </div>
          <h5 class="text-success">Certificate Verified!</h5>
          <p class="text-muted">This certificate is authentic and has been issued by Kamanga Primary School.</p>
          <div class="card">
            <div class="card-body">
              <h6>Certificate Details</h6>
              <p class="mb-1"><strong>Title:</strong> Grade 8 Final Report</p>
              <p class="mb-1"><strong>Student:</strong> Alice Johnson</p>
              <p class="mb-1"><strong>Issued:</strong> December 15, 2024</p>
              <p class="mb-1"><strong>Verification Code:</strong> CERT-2024-001234</p>
              <p class="mb-0"><strong>Status:</strong> <span class="text-success">Valid</span></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="assets/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // Sample certificate data
    const certificates = [
      {
        id: 1,
        title: "Grade 8 Final Report",
        authority: "Kamanga Primary School",
        dateIssued: "2024-12-15",
        type: "Academic",
        status: "issued",
        tags: ["Academic", "Top 5%"],
        description: "Awarded for outstanding academic performance in Grade 8",
        verificationCode: "CERT-2024-001234"
      },
      {
        id: 2,
        title: "Debate Club Championship",
        authority: "Regional Debate Association",
        dateIssued: "2024-11-20",
        type: "Participation",
        status: "issued",
        tags: ["Participation", "Leadership"],
        description: "First Place in Regional Debate Competition",
        verificationCode: "CERT-2024-001235"
      },
      {
        id: 3,
        title: "Science Olympiad Winner",
        authority: "National Science Foundation",
        dateIssued: "2024-10-10",
        type: "Merit",
        status: "issued",
        tags: ["Academic", "STEM"],
        description: "Mathematics Competition Winner",
        verificationCode: "CERT-2024-001236"
      },
      {
        id: 4,
        title: "Perfect Attendance",
        authority: "Kamanga Primary School",
        dateIssued: "2024-09-30",
        type: "Participation",
        status: "issued",
        tags: ["Attendance", "Discipline"],
        description: "Awarded for perfect attendance throughout the term",
        verificationCode: "CERT-2024-001237"
      },
      {
        id: 5,
        title: "Python Programming Basics",
        authority: "Coursera",
        dateIssued: "2024-08-15",
        type: "Digital Skills",
        status: "issued",
        tags: ["Coding", "Online Course"],
        description: "Completed Python programming fundamentals course",
        verificationCode: "CERT-2024-001238"
      },
      {
        id: 6,
        title: "Leadership Excellence",
        authority: "Kamanga Primary School",
        dateIssued: "2024-07-20",
        type: "Merit",
        status: "awaiting",
        tags: ["Leadership", "School"],
        description: "Awarded for exceptional leadership in student council",
        verificationCode: "CERT-2024-001239"
      }
    ];

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      loadCertificates();
      generateQRCode();
      setupEventListeners();
      
      // Set default certificate preview
      if (certificates.length > 0) {
        updateCertificatePreview(certificates[0]);
      }
    });

    function loadCertificates() {
      const allContainer = document.getElementById('allCertificates');
      allContainer.innerHTML = '';

      certificates.forEach(cert => {
        const certCard = createCertificateCard(cert);
        allContainer.appendChild(certCard);
      });
    }

    function createCertificateCard(cert) {
      const card = document.createElement('div');
      card.className = 'col-lg-6 col-xl-4 mb-4';
      
      const statusColors = {
        'issued': 'success',
        'awaiting': 'warning',
        'processing': 'info',
        'expired': 'danger'
      };
      
      const statusIcons = {
        'issued': 'bi-check-circle-fill',
        'awaiting': 'bi-clock-fill',
        'processing': 'bi-gear-fill',
        'expired': 'bi-x-circle-fill'
      };
      
      card.innerHTML = `
        <div class="card cert-card border-0 shadow-sm h-100">
          <div class="card-body d-flex flex-column">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <h6 class="card-title mb-0 fw-bold">${cert.title}</h6>
              <span class="badge bg-${statusColors[cert.status]} rounded-pill">
                <i class="bi ${statusIcons[cert.status]} me-1"></i>
                ${cert.status.charAt(0).toUpperCase() + cert.status.slice(1)}
              </span>
            </div>
            <p class="text-muted mb-2">
              <i class="bi bi-building me-1"></i>${cert.authority}
            </p>
            <p class="text-muted mb-3">
              <i class="bi bi-calendar-event me-1"></i>${new Date(cert.dateIssued).toLocaleDateString()}
            </p>
            <div class="cert-tags mb-3 flex-grow-1">
              ${cert.tags.map(tag => `<span class="badge bg-primary bg-opacity-75 me-1 mb-1">${tag}</span>`).join('')}
            </div>
            <div class="d-flex justify-content-between align-items-center mt-auto">
              <button class="btn btn-sm btn-outline-primary" onclick="previewCertificate(${cert.id})">
                <i class="bi bi-eye me-1"></i>Preview
              </button>
              <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-success" onclick="downloadCertificate('pdf', ${cert.id})" title="Download PDF">
                  <i class="bi bi-file-earmark-pdf"></i>
                </button>
                <button class="btn btn-outline-info" onclick="shareCertificate(${cert.id})" title="Share">
                  <i class="bi bi-share"></i>
                </button>
                <button class="btn btn-outline-secondary" onclick="downloadCertificate('image', ${cert.id})" title="Download Image">
                  <i class="bi bi-image"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
      return card;
    }

    function previewCertificate(certId) {
      const cert = certificates.find(c => c.id === certId);
      if (cert) {
        // Update certificate preview content
        updateCertificatePreview(cert);
        
        // Update modal details
        document.getElementById('certTitle').textContent = cert.title;
        document.getElementById('certAuthority').textContent = cert.authority;
        document.getElementById('certDate').textContent = new Date(cert.dateIssued).toLocaleDateString();
        document.getElementById('certType').textContent = cert.type;
        document.getElementById('certStatus').textContent = cert.status.charAt(0).toUpperCase() + cert.status.slice(1);
        document.getElementById('certVerificationCode').textContent = cert.verificationCode;
        
        const modal = new bootstrap.Modal(document.getElementById('certPreviewModal'));
        modal.show();
      }
    }

    function updateCertificatePreview(cert) {
      const certificatePreview = document.getElementById('certificatePreview');
      if (certificatePreview) {
        // Update student name - extract from certificate title or use a default
        const studentName = certificatePreview.querySelector('.student-name h3');
        if (studentName) {
          // Try to extract student name from certificate title, fallback to "STUDENT NAME"
          const nameParts = cert.title.split(' ');
          if (nameParts.length >= 2) {
            studentName.textContent = nameParts.slice(0, 2).join(' ').toUpperCase();
          } else {
            studentName.textContent = "STUDENT NAME";
          }
        }
        
        // Update achievement title
        const achievementTitle = certificatePreview.querySelector('.achievement-title h4');
        if (achievementTitle) {
          achievementTitle.textContent = cert.title.toUpperCase();
        }
        
        // Update achievement description
        const achievementDesc = certificatePreview.querySelector('.achievement-description');
        if (achievementDesc) {
          achievementDesc.textContent = cert.description;
        }
        
        // Update date with proper formatting
        const dateValue = certificatePreview.querySelector('.date-value');
        if (dateValue) {
          const date = new Date(cert.dateIssued);
          dateValue.textContent = date.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          });
        }
        
        // Update verification code
        const codeValue = certificatePreview.querySelector('.code-value');
        if (codeValue) {
          codeValue.textContent = cert.verificationCode;
        }
        
        // Update certificate type in the title
        const certTitle = certificatePreview.querySelector('.certificate-title h2');
        if (certTitle) {
          const typeMap = {
            'Academic': 'CERTIFICATE OF ACADEMIC EXCELLENCE',
            'Participation': 'CERTIFICATE OF PARTICIPATION',
            'Merit': 'CERTIFICATE OF MERIT',
            'Digital Skills': 'CERTIFICATE OF DIGITAL ACHIEVEMENT',
            'External': 'CERTIFICATE OF COMPLETION'
          };
          certTitle.textContent = typeMap[cert.type] || 'CERTIFICATE OF ACHIEVEMENT';
        }
        
        // Add animation effect
        certificatePreview.style.opacity = '0';
        setTimeout(() => {
          certificatePreview.style.transition = 'opacity 0.5s ease';
          certificatePreview.style.opacity = '1';
        }, 100);
      }
    }

    function generateQRCode() {
      const qrContainer = document.getElementById('certQR');
      if (qrContainer) {
        QRCode.toCanvas(qrContainer, 'CERT-2024-001234', function (error) {
          if (error) console.error(error);
        });
      }
    }

    function setupEventListeners() {
      // Search functionality
      document.getElementById('certSearch').addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        const cards = document.querySelectorAll('.cert-card');
        
        cards.forEach(card => {
          const title = card.querySelector('.card-title').textContent.toLowerCase();
          const authority = card.querySelector('.text-muted').textContent.toLowerCase();
          
          if (title.includes(searchTerm) || authority.includes(searchTerm)) {
            card.closest('.col-lg-6').style.display = 'block';
          } else {
            card.closest('.col-lg-6').style.display = 'none';
          }
        });
      });

      // Form submissions
      document.getElementById('certRequestForm').addEventListener('submit', function(e) {
        e.preventDefault();
        showToast('Certificate request submitted successfully!', 'success');
        bootstrap.Modal.getInstance(document.getElementById('requestCertModal')).hide();
      });

      document.getElementById('uploadCertForm').addEventListener('submit', function(e) {
        e.preventDefault();
        showToast('Certificate uploaded successfully!', 'success');
        bootstrap.Modal.getInstance(document.getElementById('uploadCertModal')).hide();
      });
    }
    
    function filterByStatus(status) {
      const cards = document.querySelectorAll('.cert-card');
      
      cards.forEach(card => {
        const statusBadge = card.querySelector('.badge');
        const statusText = statusBadge.textContent.toLowerCase().trim();
        
        if (status === 'all' || statusText.includes(status)) {
          card.closest('.col-lg-6').style.display = 'block';
        } else {
          card.closest('.col-lg-6').style.display = 'none';
        }
      });
    }
    
    function showToast(message, type = 'info') {
      const toastContainer = document.getElementById('toastContainer') || createToastContainer();
      
      const toast = document.createElement('div');
      toast.className = `toast align-items-center text-white bg-${type} border-0`;
      toast.setAttribute('role', 'alert');
      toast.setAttribute('aria-live', 'assertive');
      toast.setAttribute('aria-atomic', 'true');
      
      toast.innerHTML = `
        <div class="d-flex">
          <div class="toast-body">
            <i class="bi bi-${type === 'success' ? 'check-circle' : 'info-circle'} me-2"></i>
            ${message}
          </div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
      `;
      
      toastContainer.appendChild(toast);
      
      const bsToast = new bootstrap.Toast(toast);
      bsToast.show();
      
      // Remove toast after it's hidden
      toast.addEventListener('hidden.bs.toast', () => {
        toast.remove();
      });
    }
    
    function createToastContainer() {
      const container = document.createElement('div');
      container.id = 'toastContainer';
      container.className = 'toast-container position-fixed top-0 end-0 p-3';
      container.style.zIndex = '9999';
      document.body.appendChild(container);
      return container;
    }

    // Modal functions
    function showRequestModal() {
      const modal = new bootstrap.Modal(document.getElementById('requestCertModal'));
      modal.show();
    }

    function showUploadModal() {
      const modal = new bootstrap.Modal(document.getElementById('uploadCertModal'));
      modal.show();
    }

    function shareCertificate(certId) {
      const modal = new bootstrap.Modal(document.getElementById('shareCertModal'));
      modal.show();
    }

    function verifyCertificate() {
      const modal = new bootstrap.Modal(document.getElementById('verifyCertModal'));
      modal.show();
    }

    // Action functions
    function downloadCertificate(format, certId) {
      const cert = certificates.find(c => c.id === certId) || certificates[0];
      
      if (format === 'pdf') {
        downloadCertificateAsPDF(cert);
      } else if (format === 'image') {
        downloadCertificateAsImage(cert);
      }
    }
    
    function downloadCertificateAsPDF(cert) {
      // Update certificate with current data
      updateCertificatePreview(cert);
      
      setTimeout(() => {
        const certificateElement = document.getElementById('certificatePreview');
        
        html2canvas(certificateElement, {
          scale: 2,
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#ffffff',
          width: certificateElement.offsetWidth,
          height: certificateElement.offsetHeight
        }).then(canvas => {
          const imgData = canvas.toDataURL('image/png');
          const pdf = new jsPDF('landscape', 'mm', 'a4');
          
          const imgWidth = 297; // A4 width in mm
          const imgHeight = (canvas.height * imgWidth) / canvas.width;
          
          pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
          pdf.save(`certificate_${cert.id}_${new Date().getTime()}.pdf`);
        });
      }, 500);
    }
    
    function downloadCertificateAsImage(cert) {
      // Update certificate with current data
      updateCertificatePreview(cert);
      
      setTimeout(() => {
        const certificateElement = document.getElementById('certificatePreview');
        
        html2canvas(certificateElement, {
          scale: 2,
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#ffffff',
          width: certificateElement.offsetWidth,
          height: certificateElement.offsetHeight
        }).then(canvas => {
          const link = document.createElement('a');
          link.download = `certificate_${cert.id}_${new Date().getTime()}.png`;
          link.href = canvas.toDataURL();
          link.click();
        });
      }, 500);
    }

    function printCertificate() {
      const cert = certificates.find(c => c.id === 1) || certificates[0];
      updateCertificatePreview(cert);
      
      setTimeout(() => {
        const certificateElement = document.getElementById('certificatePreview');
        
        html2canvas(certificateElement, {
          scale: 2,
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#ffffff',
          width: certificateElement.offsetWidth,
          height: certificateElement.offsetHeight
        }).then(canvas => {
          const printWindow = window.open('', '_blank');
          printWindow.document.write('<html><head><title>Certificate Print</title></head><body><img src="' + canvas.toDataURL() + '" style="width:100%;max-width:800px;"></body></html>');
          printWindow.document.close();
          printWindow.focus();
          setTimeout(() => printWindow.print(), 100);
        });
      }, 500);
    }

    function downloadSummary() {
      // Create a comprehensive summary PDF
      const pdf = new jsPDF('portrait', 'mm', 'a4');
      
      // Add header
      pdf.setFontSize(24);
      pdf.setTextColor(40, 167, 69);
      pdf.text('KAMANGA PRIMARY SCHOOL', 105, 30, { align: 'center' });
      
      pdf.setFontSize(14);
      pdf.setTextColor(108, 117, 125);
      pdf.text('Student Achievement Summary', 105, 45, { align: 'center' });
      
      // Add student info
      pdf.setFontSize(12);
      pdf.setTextColor(44, 62, 80);
      pdf.text('Student: Alice Johnson', 20, 70);
      pdf.text('Class: Grade 8', 20, 80);
      pdf.text('Academic Year: 2024', 20, 90);
      
      // Add certificate list
      pdf.setFontSize(14);
      pdf.setTextColor(40, 167, 69);
      pdf.text('Certificates Earned:', 20, 110);
      
      let yPosition = 125;
      certificates.forEach((cert, index) => {
        if (yPosition > 250) {
          pdf.addPage();
          yPosition = 20;
        }
        
        pdf.setFontSize(12);
        pdf.setTextColor(44, 62, 80);
        pdf.text(`${index + 1}. ${cert.title}`, 25, yPosition);
        
        pdf.setFontSize(10);
        pdf.setTextColor(108, 117, 125);
        pdf.text(`   Issued: ${new Date(cert.dateIssued).toLocaleDateString()}`, 30, yPosition + 5);
        pdf.text(`   Type: ${cert.type}`, 30, yPosition + 10);
        
        yPosition += 20;
      });
      
      // Add footer
      pdf.setFontSize(10);
      pdf.setTextColor(108, 117, 125);
      pdf.text(`Generated on: ${new Date().toLocaleDateString()}`, 20, 280);
      pdf.text('Kamanga Primary School - Excellence in Education', 105, 280, { align: 'center' });
      
      pdf.save(`achievement_summary_${new Date().getTime()}.pdf`);
    }

    function copyShareLink() {
      const linkInput = document.getElementById('shareLink');
      linkInput.select();
      document.execCommand('copy');
      alert('Link copied to clipboard!');
    }

    function shareViaEmail() {
      window.open('mailto:?subject=Certificate Verification&body=Please verify my certificate at: ' + 
                  document.getElementById('shareLink').value);
    }

    function shareViaWhatsApp() {
      window.open('https://wa.me/?text=Please verify my certificate: ' + 
                  document.getElementById('shareLink').value);
    }

    function shareViaLinkedIn() {
      window.open('https://www.linkedin.com/sharing/share-offsite/?url=' + 
                  encodeURIComponent(document.getElementById('shareLink').value));
    }

    function downloadWithQR() {
      const cert = certificates.find(c => c.id === 1) || certificates[0];
      
      // Update certificate with current data
      updateCertificatePreview(cert);
      
      setTimeout(() => {
        const certificateElement = document.getElementById('certificatePreview');
        
        // Generate QR code for verification
        const qrContainer = certificateElement.querySelector('.qr-code-placeholder');
        if (qrContainer) {
          QRCode.toCanvas(qrContainer, cert.verificationCode, {
            width: 60,
            height: 60,
            margin: 2
          }, function (error) {
            if (error) console.error(error);
            
            // After QR code is generated, download the certificate
            html2canvas(certificateElement, {
              scale: 2,
              useCORS: true,
              allowTaint: true,
              backgroundColor: '#ffffff',
              width: certificateElement.offsetWidth,
              height: certificateElement.offsetHeight
            }).then(canvas => {
              const link = document.createElement('a');
              link.download = `certificate_with_qr_${cert.id}_${new Date().getTime()}.png`;
              link.href = canvas.toDataURL();
              link.click();
            });
          });
        }
      }, 500);
    }
  </script>
</body>
</html> 